{"componentChunkName":"component---src-templates-blog-post-js","path":"/2021/gatsby/2021-01-06-Gatsby-블로그-TOC만들기/","result":{"data":{"site":{"siteMetadata":{"title":"HaYoung's Log","author":"@Ha-Young","siteUrl":"https://ha-young.github.io","comment":{"utterances":"Ha-Young/my-blog"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"8ad81fda-002c-5488-b6e5-002d98488190","excerpt":"TOC 청사진 고르기 블로그를 만들면서 TOC를 추가해야겠다고 결정하였다. 이래저래 다른블로그들은 TOC를 어떻게 구성하였나 둘러보던참에,\n예전에 HEROPHY님의 블로그의 TOC가 생각났다. 안그래도 HEROPHY님의 블로그가 깔끔하고 예뻐서 참고하려는 기능들이 있었는데,\n이참에 HEROPHY님에게 클론을 해도되는지 물어보기로했다. 클론코딩 허락 HEROPHY…","html":"<h2 id=\"toc-청사진-고르기\" style=\"position:relative;\"><a href=\"#toc-%EC%B2%AD%EC%82%AC%EC%A7%84-%EA%B3%A0%EB%A5%B4%EA%B8%B0\" aria-label=\"toc 청사진 고르기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TOC 청사진 고르기</h2>\n<p>블로그를 만들면서 TOC를 추가해야겠다고 결정하였다.</p>\n<p>이래저래 다른블로그들은 TOC를 어떻게 구성하였나 둘러보던참에,\n예전에 <a href=\"https://heropy.blog/\">HEROPHY님의 블로그</a>의 TOC가 생각났다.</p>\n<p>안그래도 HEROPHY님의 블로그가 깔끔하고 예뻐서 참고하려는 기능들이 있었는데,\n이참에 HEROPHY님에게 클론을 해도되는지 물어보기로했다.</p>\n<h3 id=\"클론코딩-허락\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%A1%A0%EC%BD%94%EB%94%A9-%ED%97%88%EB%9D%BD\" aria-label=\"클론코딩 허락 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클론코딩 허락</h3>\n<p>HEROPHY님에게 블로그 몇가지 기능에대해서 클론코딩을 해도 괜찮은지 조심스럽게 메일을 통해 물어보았고 답변을 받았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 491px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVQoz5VS6W6zMBDM+z9P/3wPEYWoR1SkcONyfJjT2BDIdL1pqqiV2tTSetdiGc/OeLPdbmGMgePsIaWEXefz2W6XfD3fuTb7/R7ruqKpG0wE/BXgL2AMaLdRKbiuiySJ4fsBvOMRIsuxnBYGvCeul2/spscReZah7TrUtUSeZ2iaGmaavjH4DZQZnuYZRVEQSENgBdq2QSUrDINC13aQlURHl/02PjO0hVIDnh6fEEUxdjuHxvYQxTHSNIH76iIKQ5bEDwLqiUiahAiUEEJAvAnMp9OniQyotUZNDldVxU1VWSLL3xiwyEti3CKJbV3w2UqSkcaS+pM0haxrMvZmZHaZxh2GgZ9QQw193zPzmeSwF9rouh6GsiIptB4xkvYD9fF/H3ozYE/67BwHAY3keR4Oh2cezfd8YppRPiIMYz4HfojDy4Fqj+R45ReRihTa6BtTSIMrO6UUs7G10RRmwkhZU1jzJmJy6TGXHgrW8NaUdVkgUsHalKRfSYKXZY7i/4Au+Ic5ebj6+KPDnwztYSFQq+Xlw/mjBpapxWpqhrrnYb8DibiefnfEcxcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"클론코딩허락\"\n        title=\"클론코딩허락\"\n        src=\"/static/3834f9ca823d132ad09a375568fc93f8/13566/check-answer.png\"\n        srcset=\"/static/3834f9ca823d132ad09a375568fc93f8/5a46d/check-answer.png 300w,\n/static/3834f9ca823d132ad09a375568fc93f8/13566/check-answer.png 491w\"\n        sizes=\"(max-width: 491px) 100vw, 491px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<blockquote>\n<p>예쁜 블로그만큼이나 마음씨도 예쁘신 것 같다.</p>\n</blockquote>\n<p>이렇게 대략적인 모델이 정해졌으므로 클론코딩을 시작하면 되는데,\n나는 여기서 <u>TOC Link에만 하이라이팅을 하는 것 대신 포스트의 Header에도 하이라이팅 처리</u>를 하기로 하였다.</p>\n<p>그럼 시작.</p>\n<h2 id=\"toc-만들기\" style=\"position:relative;\"><a href=\"#toc-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"toc 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TOC 만들기</h2>\n<h3 id=\"1-header에-링크걸기\" style=\"position:relative;\"><a href=\"#1-header%EC%97%90-%EB%A7%81%ED%81%AC%EA%B1%B8%EA%B8%B0\" aria-label=\"1 header에 링크걸기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Header에 링크걸기</h3>\n<h4 id=\"gatsby-remark-autolink-headers\" style=\"position:relative;\"><a href=\"#gatsby-remark-autolink-headers\" aria-label=\"gatsby remark autolink headers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-remark-autolink-headers</h4>\n<p>Header에 링크를 거는 방법은 <code class=\"language-text\">gatsby-remark-autolink-headers</code>를 이용하면 쉽게 Markdown에 있는 Header들에 빌드할 때 자동으로 링크를 걸어준다. (<a href=\"https://www.gatsbyjs.com/plugins/gatsby-remark-autolink-headers/?=remark\">참조</a>)</p>\n<p>역시 gatsby는 remark관련 플러그인들이 많고 원하는 기능을 찾으면 다 있어서 <a href=\"\">JAMStack</a>에 대한 지원이 아주 좋다고 생각했고 gatsby를 블로그로 선택한 것을 잘했다고 느끼고 있다.</p>\n<p>나는 Jbee님의 <a href=\"https://github.com/JaeYeopHan/gatsby-starter-bee\">Gatsby-starter-bee</a>를 사용했는데 이미 포함되어있으므로 추가 설치작업은 하지 않았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">npm install gatsby<span class=\"token operator\">-</span>remark<span class=\"token operator\">-</span>autolink<span class=\"token operator\">-</span>headers</code></pre></div>\n<h4 id=\"autolink-커스터마이징\" style=\"position:relative;\"><a href=\"#autolink-%EC%BB%A4%EC%8A%A4%ED%84%B0%EB%A7%88%EC%9D%B4%EC%A7%95\" aria-label=\"autolink 커스터마이징 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>autolink 커스터마이징</h4>\n<p><code class=\"language-text\">gatsby-config.js</code>에서 아래와같이 <a href=\"https://www.gatsbyjs.com/plugins/gatsby-remark-autolink-headers/?=remark#options\">autolink 커스터마이징</a>을 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// In your gatsby-config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-remark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-remark-autolink-headers</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n            options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              offsetY<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">100</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n              icon<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">&lt;path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">&lt;/path>&lt;/svg></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n              className<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">custom-class</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n              maintainCase<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n              removeAccents<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n              isIconAfterHeader<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n              elements<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">h1</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">h4</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"2-toc-가져오기\" style=\"position:relative;\"><a href=\"#2-toc-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\"2 toc 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. TOC 가져오기</h3>\n<p>TOC를 가져오는 방법은 GraphQL Query로 가져올 수 있다. (remark로 markdown 빌드를 했을시에)</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"></span>\n<span class=\"token string\">  query getTableOfContentsExample($slug: String!) {</span>\n<span class=\"token string\">    markdownRemark() {</span>\n<span class=\"token string\">      id</span>\n<span class=\"token string\">      html</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token string\">      tableOfContents</span></span><span class=\"token string\">      frontmatter {</span>\n<span class=\"token string\">        title</span>\n<span class=\"token string\">        date(formatString: \"MMMM DD, YYYY\")</span>\n<span class=\"token string\">      }</span>\n<span class=\"token string\">    }</span>\n<span class=\"token string\">  }</span>\n<span class=\"token string\"></span><span class=\"token template-punctuation string\">`</span></span></code></pre></div>\n<p>위 처럼 <code class=\"language-text\">tableOfContents</code> 키값으로 가져올 수 있다.</p>\n<p>해당 GraphQL Query는 markdown파일에 적용되는 template에 적용시키면 되겠다. (<code class=\"language-text\">blog-post.js</code> template)</p>\n<h3 id=\"3-toc-컴포넌트-생성\" style=\"position:relative;\"><a href=\"#3-toc-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%83%9D%EC%84%B1\" aria-label=\"3 toc 컴포넌트 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. TOC 컴포넌트 생성</h3>\n<p>위 쿼리로 가져온 tableOfContents의 데이터가 text값으로 다음과같이 가져오기 때문에,</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"markdownRemark\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token property\">\"tableOfContents\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;ul>\\n&lt;li>&lt;a href='#fragment1'>First Heading&lt;/a>&lt;/li>\\n&lt;li>&lt;a href='#fragment2'>Second Heading&lt;/a>&lt;/li>\\n&lt;/ul>\"</span></span>    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>html tag에 <code class=\"language-text\">dangerouslySetInnerHTML</code>로 적용시키면 별도 핸들링 없이 그대로 구현할 수 있다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">TableOfContents</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> toc <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"toc-container\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"toc-wrapper\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"toc-content\"</span><span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">          <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"toc\"</span> dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> __html<span class=\"token operator\">:</span> toc <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span></span>        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"toc-open-btn\"</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onClickTOCOpen<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같은 형식을 취해주면 된다.</p>\n<h3 id=\"4-toc에-하이라이트효과-부여\" style=\"position:relative;\"><a href=\"#4-toc%EC%97%90-%ED%95%98%EC%9D%B4%EB%9D%BC%EC%9D%B4%ED%8A%B8%ED%9A%A8%EA%B3%BC-%EB%B6%80%EC%97%AC\" aria-label=\"4 toc에 하이라이트효과 부여 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. TOC에 하이라이트효과 부여</h3>\n<p>이 방법을 실현하려면 두 가지 방법이 있는 것 같다.</p>\n<ul>\n<li><code class=\"language-text\">scrollEvent</code>에서 Header가 윗부분으로 오는지 체크</li>\n<li><code class=\"language-text\">IntersectionObserver</code>를 <code class=\"language-text\">rootMargin</code>을 위쪽영역으로 하여 가시성이 보이는 순간(<code class=\"language-text\">isIntersecting</code>) 체크</li>\n</ul>\n<p>개인적인 판단으로는 <code class=\"language-text\">scrollEvent</code>에서 스크롤의 매 순간 header의 영역과 window <code class=\"language-text\">offsetY</code>를 체크하여 계산하기보다는 <code class=\"language-text\">IntersectionObserver</code>로 Header들의 가시성이 변환 될 때만 체크를 하는 것이 더 효율적으로 생각되었다.</p>\n<p>따라서 <code class=\"language-text\">IntersectionObserver</code>를 이용해 체크하기로 결정.</p>\n<p>그리고 header의 id가 toc linke의 id에 포함되어 있으므로 css property <code class=\"language-text\">\\*=</code>를 이용한 선택자를 사용하였다.</p>\n<blockquote>\n<p>IntersectionObserver에 대해서 잘 모른다면 <a href=\"https://heropy.blog/2019/10/27/intersection-observer/\">HEROPY님의 포스팅</a>을 참고하자.</p>\n<p>정리가 매우 잘 되어 있다. 👍</p>\n</blockquote>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span></span>    <span class=\"token parameter\">entries</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> headerElement <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span>target\n        <span class=\"token keyword\">const</span> tocLinkElement <span class=\"token operator\">=</span> Dom<span class=\"token punctuation\">.</span><span class=\"token function\">getElement</span><span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">          <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">a[href*=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">encodeURI</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"]</span><span class=\"token template-punctuation string\">`</span></span></span>        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span>isIntersecting<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          headerElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-header-active'</span><span class=\"token punctuation\">)</span>\n          tocLinkElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-active'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>currentYPos <span class=\"token operator\">&lt;</span> targetStaticYPos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 스크롤을 위로 올려서 헤더 주제를 벗어난 경우</span>\n          headerElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-header-active'</span><span class=\"token punctuation\">)</span>\n          tocLinkElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-active'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">{</span> rootMargin<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">0% 0% -85% 0%</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span></span>  <span class=\"token punctuation\">)</span>\n\n  headerElements <span class=\"token operator\">=</span> <span class=\"token function\">getHeaderElements</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  headerElements<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">headerElement</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    observer<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>headerElement<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>다음과 같이 <code class=\"language-text\">TableOfContents</code> 컴포넌트 내부에서 <code class=\"language-text\">IntersectionObserver</code>를 이용해 현재 보고있는 Content의 Header를 체크하고 효과를 주기위해 css class를 toggle하였다.</p>\n<p>observing하는 root는 <code class=\"language-0\"> 0</code>로 설정해서 Header가 root로 설정한 상위 observing 영역에 올 경우\n<code class=\"language-text\">entry.isIntersection</code>으로 체크하였다.</p>\n<p>여기서 이것저것 해보다가 발견한 사실이 또 있는데\n<code class=\"language-text\">entry.boundingClientRect.top + window.pageYOffset</code>의 결과가 Element의 static한 top 좌표라는 사실을 알게되었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1099px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 84.66666666666669%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADNklEQVQ4y42T2U8TURTG+1coRbAKdNpOFzrT0mHaUloKlFUQDbgCYSmLKHUlLCGSEBPFRPEFfZFIXBP9D0x88cHoq/FdURMTIJKC3ft55nYRjRFv8su5584933x3U03wHPpNHIaMWoxY9JhrrGOMiWYMUz5SbmDjQyYdgjRvJ0O5Pl+GoGjC3UA9VG3lHKw2HSoEDi7Zgva2enQcDqCpsRo1Xgf8Pgd8HjskuwE2qxZ2mmcXtLApUF4h6uAgzCKHDr4EqjNGDl0WDsdNWvRJVgxXSRh2Oyg6MFApYEAWMei0sX5QtiHosmOA8iGnnXIRJ8wcThGdpHHRqIOqiRzmaBUNFHVotGgJDi2CntEsGNBDRSFei3FjZqn9Ao+zVh592aWP0HgvRZVb0EHBRfb9cjna6tw4lKXJJ6HFL6O5phIdlHc1eNFZX4XOgAceqvGUa1FNsdrKMZQxFUuyHwOyFR1UcIRo9zsxcOwIQv29GOs+SeMetPoq0cKQ4HeY4LPzmdqsWEZQ+YPi0FyK4621mL10DjMXxjA5Poxr05exMDeNa7MzmBgdRGiwG2f7TjKUfijYjXpaVZWlLO+UCfpsdIJlhVi6fQNKi8WiSKeSWF3bwsfPa/ix8Qmr65+xtvaNfU+lUox0Oo3ThxshGfbDK+qZ6A5BNe4t3swXKG11PYq3bz4g8v45nr5+h/evXgKJOBJp5Ns/BAtxd3GBTYrH44wkFafSGfFYPBOTyRQi0QRzt4ugOi8YjUaxHYkgvLVFy49RcYqRW2qEvinCuzpcunUj6zCGVDjMCjc2viMc3sY6xc3NMP2MlpxIkKBCkgQbSFDzhyAdv1iqxvLSnV+b8/UL/qf1HG2GpFccGn4JKuqVvAbjgz148ewJHq8s4/HDlUxcub+DZcajB/fztNXIcJlKfneoXEwvPXBBfxAlmiKUaoqhKVJjX8EeFKv3oriw4Df270A2l8FLGspd9OTuYU60TrLQRbWiVjKz6LPxcNOFl/kDkI1/gcY97KVxCHgq4KWtywiSXSfZVvbj+twk5umFzM9cYfHqRAhToRFMnR9lTIYyTFN/+sIZNLgEuMldnVOAlw73J+sg+REl1scQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"rootMargin\" title=\"rootMargin\" src=\"/static/729e2e7a886e1483a3ae714111f152ce/2c95d/rootMargin.png\" srcset=\"/static/729e2e7a886e1483a3ae714111f152ce/5a46d/rootMargin.png 300w,\n/static/729e2e7a886e1483a3ae714111f152ce/0a47e/rootMargin.png 600w,\n/static/729e2e7a886e1483a3ae714111f152ce/2c95d/rootMargin.png 1099w\" sizes=\"(max-width: 1099px) 100vw, 1099px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n<h3 id=\"5-문제점-발견\" style=\"position:relative;\"><a href=\"#5-%EB%AC%B8%EC%A0%9C%EC%A0%90-%EB%B0%9C%EA%B2%AC\" aria-label=\"5 문제점 발견 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 문제점 발견</h3>\n<p>이 다음단계로 <code class=\"language-text\">Intersectioning</code> 하는 부분을 따로 hooks로 분리시키는 등의 리팩토링을 진행하려고 하였으나,\n문제점을 발견하였다.</p>\n<p>나는 <code class=\"language-text\">entry.isIntersection</code>으로 체크가 되었을 때 하이라이팅처리, <code class=\"language-text\">IntersectionObserver</code>를 통한 계산값으로 스크롤을 헤더 위로 올렸을때 하이라이팅을 제거하도록해서 css class를 toggle시키는 방법을 선택했었다.</p>\n<p>스크롤 하면서 처음 보여질 때 css classname을 추가해서 하이라이트 처리가 되도록하고,\n스크롤을 위로올리면서 두번째로 보여질 때 cssclassname을 제거하면서 하이라이트를 제거하려고 하였다.</p>\n<blockquote>\n<p>HEROPHY님 Tech blog 처럼 읽은 주제에 대해서는 하이라이트, 다시 위로 올리면 하이라이트제거</p>\n</blockquote>\n<p>하지만, <strong>header #경로로 이동할 때 스크롤의 속도가 너무 빨라 <code class=\"language-text\">isIntersection</code> <code class=\"language-text\">true</code>가 발생하지않아 toggle이 꼬이는 상황이 발생</strong>하였다.</p>\n<p>그래서 이래저래 로그도 찍어보면서 방법을 강구한 결과, <code class=\"language-text\">scroll Event</code>로 각 Header들의 위치판단으로 적용시키기로 하였다.</p>\n<h4 id=\"해결책\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0%EC%B1%85\" aria-label=\"해결책 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결책</h4>\n<ul>\n<li><code class=\"language-text\">Scroll Event</code> 사용하기로 결정</li>\n<li>낮아진 효율성은 <code class=\"language-text\">Scroll Event</code>에 Task Queue(Event Queue)대신 Animation frames(<code class=\"language-text\">rAF</code>)으로 처리되도록 하기 - <a href=\"https://jbee.io/web/optimize-scroll-event/\">Jbee님의 스크롤이벤트 최적화 포스트 참조</a></li>\n</ul>\n<h3 id=\"6-해결책-scroll-event-적용\" style=\"position:relative;\"><a href=\"#6-%ED%95%B4%EA%B2%B0%EC%B1%85-scroll-event-%EC%A0%81%EC%9A%A9\" aria-label=\"6 해결책 scroll event 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 해결책 (Scroll event) 적용</h3>\n<p>위 해결책을 적용하기 위해 기존에 <a href=\"https://github.com/JaeYeopHan/gatsby-starter-bee\">gatsby-starter-bee</a> 에 존재하는 <code class=\"language-text\">onScroll</code>과 <code class=\"language-text\">toFit</code>을 적용시키고 scroll Event로 잘 수행되는지 확인해보았다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber 0\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// TableOfContents</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onScroll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> currentoffsetY <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>pageYOffset\n  <span class=\"token keyword\">const</span> headerElements <span class=\"token operator\">=</span> <span class=\"token function\">getHeaderElements</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> headerElement <span class=\"token keyword\">of</span> headerElements<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> top <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> headerElement<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> elementTop <span class=\"token operator\">=</span> top <span class=\"token operator\">+</span> currentoffsetY\n    <span class=\"token keyword\">const</span> tocLinkElement <span class=\"token operator\">=</span> Dom<span class=\"token punctuation\">.</span><span class=\"token function\">getElement</span><span class=\"token punctuation\">(</span>\n      <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">a[href*=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">encodeURI</span><span class=\"token punctuation\">(</span>headerElement<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"]</span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>currentoffsetY <span class=\"token operator\">>=</span> elementTop <span class=\"token operator\">-</span> <span class=\"token constant\">HEADER_OFFSET_Y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      headerElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-header-active'</span><span class=\"token punctuation\">)</span>\n      tocLinkElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-active'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      headerElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-header-active'</span><span class=\"token punctuation\">)</span>\n      tocLinkElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-active'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token function\">useScrollEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">return</span> EventManager<span class=\"token punctuation\">.</span><span class=\"token function\">toFit</span><span class=\"token punctuation\">(</span>onScroll<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>잘 작동하는 것을 확인하였다.</p>\n<p>적용된 <code class=\"language-text\">useScrollEvent</code>와 <code class=\"language-text\">toFit</code> 함수는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// useScrollEvent</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useScrollEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">onScroll</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">scroll</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> onScroll<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> passive<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">scroll</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> onScroll<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> passive<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// toFit</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">toFit</span><span class=\"token punctuation\">(</span>\n  cb<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token function-variable function\">dismissCondition</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">triggerCondition</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>cb<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid required arguments'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">let</span> tick <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tick<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span>\n\n    tick <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">dismissCondition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        tick <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">triggerCondition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        tick <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"7--url-불편함-제거\" style=\"position:relative;\"><a href=\"#7--url-%EB%B6%88%ED%8E%B8%ED%95%A8-%EC%A0%9C%EA%B1%B0\" aria-label=\"7  url 불편함 제거 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. # url 불편함 제거</h3>\n<p>다 완성하고 난 후에 이래저래 테스트를 해보다보니 불편함 점을 발견했다.\nTOC 컴포넌트의 Link를 클릭하면 <code class=\"language-text\">originURL/#header</code> 처럼 url이 바뀌기 때문에 나중에 뒤로가기를 수행하였을 경우 이전에 클릭했던 TOC Link(URL)로 이동하게 되는 것.</p>\n<p>그래서 번거롭지만 각 TOC Link에 <u>Click EventListener</u>를 추가하였다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> headerElements <span class=\"token operator\">=</span> <span class=\"token function\">getHeaderElements</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  headerElements<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">headerElement</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    headerElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-header'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// active 애니메이션 효과를 위해 사전에 클래스 추가</span>\n\n    <span class=\"token keyword\">const</span> headerElementTop <span class=\"token operator\">=</span> <span class=\"token function\">getElementTopPos</span><span class=\"token punctuation\">(</span>headerElement<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> tocLinkElement <span class=\"token operator\">=</span> Dom<span class=\"token punctuation\">.</span><span class=\"token function\">getElement</span><span class=\"token punctuation\">(</span>\n      <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">a[href*=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">encodeURI</span><span class=\"token punctuation\">(</span>headerElement<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"]</span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">)</span>\n\n<span class=\"gatsby-highlight-code-line\">    tocLinkElement<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">      window<span class=\"token punctuation\">.</span><span class=\"token function\">scroll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> top<span class=\"token operator\">:</span> headerElementTop<span class=\"token punctuation\">,</span> behavior<span class=\"token operator\">:</span> <span class=\"token string\">'smooth'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>어찌보면 간단한 기능처럼 보이는데, 생각보다 오래작업하게 되었고 배운것도 정말 많다.</p>\n<ul>\n<li>IntersectionObserver</li>\n<li>CSS <code class=\"language-text\">className[propertyName*=&quot;likeSearch&quot;]</code> 선택자</li>\n<li>scroll event 최적화</li>\n<li>window.scroll</li>\n<li>미리 작성된 양질의 코드 재사용 (<code class=\"language-text\">Jbee</code> 님의 소스를 보면서 많이 배웠다.)</li>\n</ul>\n<h2 id=\"참조\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참조</h2>\n<ul>\n<li><a href=\"https://heropy.blog/2019/10/27/intersection-observer/\">HEROPHY님의 IntersectionObserver</a></li>\n<li><a href=\"https://blueshw.github.io/2020/05/30/table-of-contents/\">보노님의 TOC만들기 포스트</a></li>\n<li><a href=\"https://jbee.io/web/optimize-scroll-event/\">Jbee님의 스크롤이벤트 최적화</a></li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#toc-%EC%B2%AD%EC%82%AC%EC%A7%84-%EA%B3%A0%EB%A5%B4%EA%B8%B0\">TOC 청사진 고르기</a></p>\n<ul>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#%ED%81%B4%EB%A1%A0%EC%BD%94%EB%94%A9-%ED%97%88%EB%9D%BD\">클론코딩 허락</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#toc-%EB%A7%8C%EB%93%A4%EA%B8%B0\">TOC 만들기</a></p>\n<ul>\n<li>\n<p><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#1-header%EC%97%90-%EB%A7%81%ED%81%AC%EA%B1%B8%EA%B8%B0\">1. Header에 링크걸기</a></p>\n<ul>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#gatsby-remark-autolink-headers\">gatsby-remark-autolink-headers</a></li>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#autolink-%EC%BB%A4%EC%8A%A4%ED%84%B0%EB%A7%88%EC%9D%B4%EC%A7%95\">autolink 커스터마이징</a></li>\n</ul>\n</li>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#2-toc-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\">2. TOC 가져오기</a></li>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#3-toc-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%83%9D%EC%84%B1\">3. TOC 컴포넌트 생성</a></li>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#4-toc%EC%97%90-%ED%95%98%EC%9D%B4%EB%9D%BC%EC%9D%B4%ED%8A%B8%ED%9A%A8%EA%B3%BC-%EB%B6%80%EC%97%AC\">4. TOC에 하이라이트효과 부여</a></li>\n<li>\n<p><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#5-%EB%AC%B8%EC%A0%9C%EC%A0%90-%EB%B0%9C%EA%B2%AC\">5. 문제점 발견</a></p>\n<ul>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#%ED%95%B4%EA%B2%B0%EC%B1%85\">해결책</a></li>\n</ul>\n</li>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#6-%ED%95%B4%EA%B2%B0%EC%B1%85-scroll-event-%EC%A0%81%EC%9A%A9\">6. 해결책 (Scroll event) 적용</a></li>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#7--url-%EB%B6%88%ED%8E%B8%ED%95%A8-%EC%A0%9C%EA%B1%B0\">7. # url 불편함 제거</a></li>\n</ul>\n</li>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></li>\n<li><a href=\"/2021/gatsby/2021-01-06-Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-TOC%EB%A7%8C%EB%93%A4%EA%B8%B0/#%EC%B0%B8%EC%A1%B0\">참조</a></li>\n</ul>","frontmatter":{"title":"Gatsby 블로그 TOC 만들기","date":"January 07, 2021"}}},"pageContext":{"slug":"/2021/gatsby/2021-01-06-Gatsby-블로그-TOC만들기/","previous":{"fields":{"slug":"/2020/gatsby/Add-Google-Analytics/"},"frontmatter":{"title":"블로그를 Google Analytics에 추가","category":"gatsby","draft":false}},"next":{"fields":{"slug":"/2021/javascript/하옹의-자바스크립트-식사---Prototype/"},"frontmatter":{"title":"하옹의 자바스크립트 식사 - Prototype","category":"javascript","draft":false}}}},"staticQueryHashes":["1402886152","145675779","3128451518"]}