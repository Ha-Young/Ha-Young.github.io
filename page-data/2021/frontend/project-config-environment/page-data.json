{"componentChunkName":"component---src-templates-blog-post-js","path":"/2021/frontend/project-config-environment/","result":{"data":{"site":{"siteMetadata":{"title":"HaYoung's Log","author":"@Ha-Young","siteUrl":"https://ha-young.github.io","comment":{"utterances":"Ha-Young/my-blog"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"4263479d-2d08-57e3-b5b8-b6ed1f58dd14","excerpt":"어플리케이션을 운영하려면 개발, 운영 환경을 분리하고 사용해야된다.\n당연히 개발환경과 운영환경이 나눠져있어야 테스트, 운영이 가능하고 특히나 로컬에서만 개발한 작업을 개발서버에 올리면 서로 작업한 것들을 합친 결과물을 테스트해볼 수 있는 등 협업도 가능해진다. 일반적인 서버 개발환경은 일반적으로  -  -  -  - 으로 나눠지는 것 같다. 각각의 개발 환경에 따라, 역할과 목적이 다르고, 그에 따라서 시스템의 크기도 다르다. 보통 프론트앤드에서는 AWS…","html":"<p>어플리케이션을 운영하려면 개발, 운영 환경을 분리하고 사용해야된다.\n당연히 개발환경과 운영환경이 나눠져있어야 테스트, 운영이 가능하고 특히나 로컬에서만 개발한 작업을 개발서버에 올리면 서로 작업한 것들을 합친 결과물을 테스트해볼 수 있는 등 협업도 가능해진다.</p>\n<p>일반적인 서버 개발환경은 일반적으로 <code class=\"language-text\">Local</code> - <code class=\"language-text\">Develop</code> - <code class=\"language-text\">QA</code> - <code class=\"language-text\">Staging</code> - <code class=\"language-text\">Production</code>으로 나눠지는 것 같다. 각각의 개발 환경에 따라, 역할과 목적이 다르고, 그에 따라서 시스템의 크기도 다르다.</p>\n<p>보통 프론트앤드에서는 AWS등과 같은 클라우드서비스를 이용해서 프론트서버를 구축하는데, 이 클라우드 서비스의 리소스나 가격정책을 각 환경별로 다르게 가져가고 있다. 당연히 실 운영서버가 아니기 때문에 트래픽이 없는 Dev, QA 쪽은 저가격대를 형성하도록 구성하게되고 Stage는 실 서버와 가장 비슷하게 구성을 하도록 하는 것 같다.</p>\n<h2 id=\"왜-환경별-설정을-다르게-가져가야-하나\" style=\"position:relative;\"><a href=\"#%EC%99%9C-%ED%99%98%EA%B2%BD%EB%B3%84-%EC%84%A4%EC%A0%95%EC%9D%84-%EB%8B%A4%EB%A5%B4%EA%B2%8C-%EA%B0%80%EC%A0%B8%EA%B0%80%EC%95%BC-%ED%95%98%EB%82%98\" aria-label=\"왜 환경별 설정을 다르게 가져가야 하나 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왜 환경별 설정을 다르게 가져가야 하나?</h2>\n<p>개발환경이라는 말은 Application이 작동하는 환경이라는 말과 같다. 이 환경은 특히 실 데이터를 담고있는 백엔드 측에서 가장 중요하고 메인이기 때문에 프론트에서는 각 개발 환경과 동일한 백엔드의 환경을 사용, 통신해야 한다.</p>\n<p>프론트에서 주로 백엔드의 API를 호출한다면, 현재 환경에 맞는 백엔드 환경의 API를 호출해야 된다.</p>\n<blockquote>\n<p>프론트를 develop 환경에서 실행했다면 백엔드에 호출하는 API 또한 development 백엔드 환경의 API를 호출해야한다.</p>\n</blockquote>\n<p>때문에 각 환경별로 API 경로를 가지거나 인증값, access token과 같은 비밀키 정보를 가지는 설정파일이 필요하고, 당연히 각 환경에 맞게 필요한 데이터들이나 설정값들이 달라질 수 밖에 없다.</p>\n<p>이러한 설정값들을을 별도 파일로 분리시켜서 관리하게되고 각 환경에 맞게 설정파일을 적용시켜서 사용한다.</p>\n<h2 id=\"기존에-방식은-어떻게\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EC%A1%B4%EC%97%90-%EB%B0%A9%EC%8B%9D%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C\" aria-label=\"기존에 방식은 어떻게 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기존에 방식은 어떻게?</h2>\n<p>기존의 방식 중 가장 기본적인 방법은 아무래도 프레임워크의 도움을 받는것이다.</p>\n<p>프레임워크에서 각 환경설정파일들만 마련해둔다면 실행 환경에 맞게 설정파일을 자동 매칭되도록 설정해주며, 코드상에서는 별도 분기처리없이 하나의 config파일만 보면 되도록 설계가 되어있다.</p>\n<p>하지만, 이러한 프레임워크의 도움을 받지 못하는 경우에는 직접 구현해야한다.</p>\n<p>기존에 우리회사에서 했던 방식은 두가지가 있었다.</p>\n<ol>\n<li>Config 싱글톤 클래스를 이용한 코드단에서 가져오는 설정 및 가져오는방식.</li>\n<li>CI/CD(Jenkins pipeline)단계에서 Config 파일을 현재 환경에 맞게 바꿔치기.</li>\n</ol>\n<p>1번 방법은 우선 config 클래스를 싱글톤으로 만들어서 Application의 실행시점에서 싱글톤 인스턴스에 값을 세팅해두고 config 값이 필요할 때 싱글톤 인스턴스를 참조하면서 사용하는 방식이다. <br>\n이 방법은 직접 싱글톤을 만들어야되는 단점과, 실행시점에 Config를 매핑하는 리소스가 들어가므로 비효율적이다.</p>\n<p>2번 방법은 각 설정파일이 있는 상태에서 Config 파일로 가져올 수 있는 파일(index.ts - 기존 develop 환경으로 세팅)이 존재하고, Jenkins 파이프라인에서 이 index.ts를 각 설정환경에 맞게 바꿔치기 하도록 설정하는 방법이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 738px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACM0lEQVQoz0WRy27TQBSGj2QvWdAFiEWhtHGa+DrjsT22Z5z4ErdJc2mVVoBQy6JigUDcJFixYc8DoO7Y400k3oF36IOgbCIdJlELi0//mZHmm6NzgIsceZpjkPTx4Z6Jj9vOSrHOxW7bBU4H+rG40Kr4VOO0p53FhSbcRCv5qTaT55pFYi2sMi2fDzQ3TjQw6ycYyQoZz7DV9TbCHcNGxeLBngGn/Ut4Ub6FiTwHwQq4lDVUVMJYXMDz/BXYNIH0KIfhxRBolgLcmX1CIgbYy2vkolyLbjp0FxU7gcivv2Xh+JfKn56XNn0mG+4r2GEjglFjerwhqWiCPGucMGng/vwzJoMTHB8/w2o0x7g3XHW9BG0qF++nXyENRteDeI5KgD4RWAUZMpJgxGrsh1PsuhypFMirHtosRrg3+4h+NsTyYIp5PUUa9VeGFeC+HS62OxYYFvvdsigaNvuj7paGoq3Yt9myZfnLjh0tO5a67wbLfZWwNXmHJK0wVsuR+QGabri6Wc7iZf4BCn5yPUyfooymKFgfJ7zAUZRjj2WY+hLHUaE6T7DtRNhRwNbRG/SSEjM1Q9OLcHu3+2/LbTMEh2ZfPL/4YdPsuxrDlaNwaXZ1W68xibiyiNwAW6PXSJQwkQU6vvrJpJstr4U7hgXEL4CxCmwiwSECXAWh/+s1auZgeukGuKs69GWN49kcy8MJclmuHrVuhTaYTqL7fqk7JNPVY51QoVMqdU/Vt2cl0pV0k38BmIHgnS8HvycAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2번째 방법\"\n        title=\"2번째 방법\"\n        src=\"/static/b1220b12bd8e8bda1995cf17fb1f584c/774b6/2th_method_files.png\"\n        srcset=\"/static/b1220b12bd8e8bda1995cf17fb1f584c/5a46d/2th_method_files.png 300w,\n/static/b1220b12bd8e8bda1995cf17fb1f584c/0a47e/2th_method_files.png 600w,\n/static/b1220b12bd8e8bda1995cf17fb1f584c/774b6/2th_method_files.png 738w\"\n        sizes=\"(max-width: 738px) 100vw, 738px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>왼쪽 이미지는 파일 구조이고 오른쪽은 실제 Import해서 쓰일 index.ts의 구조이다.</p>\n<p>보시다시피 index.ts는 dev환경을 import해서 내보내고있고 실제 코드상에서는 이 index.ts를 import해서 사용하게된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Conf <span class=\"token keyword\">from</span> <span class=\"token string\">'@/conf'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n<span class=\"token keyword\">const</span> productAPI <span class=\"token operator\">=</span> Conf<span class=\"token punctuation\">.</span>apis<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">;</span></code></pre></div>\n<p>그래서 코드상에서는 dev파일로 사용하게 되는것이지만 Jenkins 파이프라인 단계에서</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jenkins_pipeline\"><pre class=\"language-jenkins_pipeline\"><code class=\"language-jenkins_pipeline\">publishAppPipeline meta: meta, timeoutMin: 10, {\n  docker.image(&#39;node:12&#39;).inside(&#39;-v /etc/localtime:/etc/localtime:ro&#39;) {\n    sh &quot;&quot;&quot;\n      echo ${meta.versionLabel} &gt; VERSION \\\n      &amp;&amp; npm ci \\\n      &amp;&amp; cp -f conf/${meta.env}.ts conf/index.ts \\\n      &amp;&amp; SERVICE_ENV=${meta.env} npm run build \\\n      &amp;&amp; npm prune --production \\\n    &quot;&quot;&quot;\n    \n    ...</code></pre></div>\n<p>위 처럼 index.ts을 환경에 맞는 파일로 변경시켜서 사용한다.</p>\n<p>이 방법은 별도로 Config 싱글톤 클래스를 만들어주지않고 CI/CD 단계에서 실행되는 것이기 때문에 1번처럼 Application의 실행에 있어 관여하지 않는다는 장점이 있지만, Jenkins pipeline을 알아야되고 Jenkins와 같은 CI/CD 툴을 사용하지 않는다면 사용할 수 없다.</p>\n<h2 id=\"웹팩을-이용해보자\" style=\"position:relative;\"><a href=\"#%EC%9B%B9%ED%8C%A9%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%B4%EB%B3%B4%EC%9E%90\" aria-label=\"웹팩을 이용해보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>웹팩을 이용해보자</h2>\n<p>나는 위 2번 방법을 보면서 웹팩으로 가능할 것 같다는 판단을 내렸고</p>\n<p>방법을 찾아봤다.</p>\n<p>첫번째로 시도한 방법은 webpack의 <a href=\"https://webpack.js.org/plugins/normal-module-replacement-plugin/\">NormalModuleReplacement 플러그인</a> 이었다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">ENV</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">||</span> <span class=\"token string\">'develop'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">env</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>NormalModuleReplacementPlugin</span><span class=\"token punctuation\">(</span></span>        <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">config\\index.ts</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resource</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'###before'</span><span class=\"token punctuation\">,</span> resource<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">          resource<span class=\"token punctuation\">.</span>request <span class=\"token operator\">=</span> resource<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token string\">'index'</span><span class=\"token punctuation\">,</span></span>            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">ENV</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'###after'</span><span class=\"token punctuation\">,</span> resource<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>console을 찍어봤을때는 resource.request가 올바르게 캐치되어 경로가 변경되는것을 확인했으나, 실제 작동은 변경되지 않았었다.</p>\n<blockquote>\n<p>stack overflow를 뒤져보니 webpack 버전이 올라가면서 작동이 안된다는 말을듣고 우선 보류.</p>\n</blockquote>\n<p>추가로 찾아보니 <a href=\"https://www.npmjs.com/package/file-replace-loader\">file-replace-loader</a> 웹팩 로더가 있어서 사용해봤다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> resolve <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">ENV</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">||</span> <span class=\"token string\">'develop'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//...</span>\n  module<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">config\\/index.ts$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n      loader<span class=\"token operator\">:</span> <span class=\"token string\">'file-replace-loader'</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        condition<span class=\"token operator\">:</span> <span class=\"token string\">'always'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">replacement</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resourcePath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'###before'</span><span class=\"token punctuation\">,</span> resourcePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'###after'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./config/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">ENV</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.ts</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">return</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./config/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">ENV</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.ts</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        async<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Console 찍어봤을 때 성공적으로 변경되고 실제로 작동도 되는것을 확인했다.</p>\n<p>다만, file-replace-loader가 믿을만한 로더인것인가였는데, 주간 1K다운로드를 기록하고있으면서 issue도 1개 거기다 동작오류는 아니었기 때문에 사용해도 괜찮을 것 같다고 판단하였다.</p>\n<p>실제 프로젝트에서는 next를 사용하고 있기 때문에 next.config에서 webpack 설정을 하였으며 코드는 아래와 같다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> resolve <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">ENV</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">||</span> <span class=\"token string\">'development'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/** @type {import('next').NextConfig} */</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  reactStrictMode<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n  \n  <span class=\"token function\">webpack</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    \n<span class=\"gatsby-highlight-code-line\">    config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">config\\/index.ts$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      loader<span class=\"token operator\">:</span> <span class=\"token string\">'file-replace-loader'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        condition<span class=\"token operator\">:</span> <span class=\"token string\">'always'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token function\">replacement</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resourcePath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token keyword\">return</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./config/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">ENV</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.ts</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">        async<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span>\t\t\n    <span class=\"token operator\">...</span>\n    \n    <span class=\"token keyword\">return</span> config<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 각 배포환경에서 환경변수를 적용해두면 되거나,</p>\n<p><code class=\"language-text\">NODE_ENV=production</code></p>\n<p>로컬에서 실행할 때 NODE_ENV를 설정하면 잘 작동한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"package.json\"><pre class=\"language-package.json\"><code class=\"language-package.json\">&quot;scripts&quot;: {\n    &quot;dev&quot;: &quot;NODE_ENV=develop next dev&quot;,\n    &quot;qa&quot;: &quot;NODE_ENV=qa next dev&quot;,\n    &quot;stage&quot;: &quot;NODE_ENV=stage next dev&quot;\n }</code></pre></div>","tableOfContents":"<ul>\n<li><a href=\"/2021/frontend/project-config-environment/#%EC%99%9C-%ED%99%98%EA%B2%BD%EB%B3%84-%EC%84%A4%EC%A0%95%EC%9D%84-%EB%8B%A4%EB%A5%B4%EA%B2%8C-%EA%B0%80%EC%A0%B8%EA%B0%80%EC%95%BC-%ED%95%98%EB%82%98\">왜 환경별 설정을 다르게 가져가야 하나?</a></li>\n<li><a href=\"/2021/frontend/project-config-environment/#%EA%B8%B0%EC%A1%B4%EC%97%90-%EB%B0%A9%EC%8B%9D%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C\">기존에 방식은 어떻게?</a></li>\n<li><a href=\"/2021/frontend/project-config-environment/#%EC%9B%B9%ED%8C%A9%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%B4%EB%B3%B4%EC%9E%90\">웹팩을 이용해보자</a></li>\n</ul>","frontmatter":{"title":"하옹의 프론트앤드 이야기 - 개발 환경이란? 웹팩을 이용해 개발환경 설정값 변경하기","date":"December 29, 2021"}}},"pageContext":{"slug":"/2021/frontend/project-config-environment/","previous":{"fields":{"slug":"/2021/retrospect/2021_2rd_retrospect/"},"frontmatter":{"title":"[하옹의 회고] 2021년 하반기 - 첫 프론트앤드 개발, 프론트앤드 개발자로 6개월동안 배운 것","category":"retrospect","draft":false}},"next":null}},"staticQueryHashes":["1402886152","145675779","3128451518"]}